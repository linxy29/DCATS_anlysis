---
title: "Generate cell pool"
output: html_document
---

```{r,message=FALSE,warning=FALSE}
library(splatter)
library(Seurat)
```

## 3 clusters

### discrete cell pool

### closer-cluster cell pool

```{r,eval=FALSE}
## simulate cells pool setting
set.seed(123)
prob = rep(1/3, 3)
batch_size = 10000
de_prob = runif(3, 0.1, 0.4)
setresolu = 0.2
sample_size = 1000
```

```{r,eval=FALSE}
## simulate cells pool process
set.seed(123)
params = readRDS("./data/ovarian_params.rds")
#params = readRDS("./data/mnnCT7params.rds")
param.groups <- setParams(params, batchCells = batch_size, nGenes = 1000)
sim <- splatSimulateGroups(param.groups, group.prob = prob, de.prob = de_prob, de.facLoc = 0.01, verbose = FALSE)
sim_mat <- counts(sim)
origLabels = sim@colData@listData$Group
# Save multiple objects
save(sim_mat, origLabels, file = "./data/cells_pool3_close.RData")
```

```{r}
seuratObj <- CreateSeuratObject(counts = sim_mat, project="Splatter")
seuratObj <- NormalizeData(seuratObj, verbose = FALSE)
seuratObj <- FindVariableFeatures(seuratObj, selection.method = "vst", nfeatures = 2000, verbose = FALSE)
seuratObj <- RunPCA(seuratObj, features = VariableFeatures(object = pbmc))
seuratObj <- FindNeighbors(seuratObj, dims = 1:30, verbose = FALSE)
seuratObj <- FindClusters(seuratObj, resolution = setresolu, verbose = FALSE)
seuratObj <- RunUMAP(seuratObj, dims = 1:30, verbose = FALSE)
DimPlot(pbmc, reduction = "umap")
```

